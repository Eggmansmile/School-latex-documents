name: Build LaTeX

on:
  push:
    branches: [ main, master, MAIN ]
    tags:
      - 'v*'
  pull_request:
    branches: [ main, master, MAIN ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install TeX Live (minimal set)
        run: |
          sudo apt-get update
          sudo apt-get install -y --no-install-recommends \
            texlive-latex-recommended texlive-latex-extra texlive-xetex \
            texlive-fonts-recommended texlive-fonts-extra texlive-pictures \
            texlive-science texlive-bibtex-extra biber texlive-lang-european \
            texlive-plain-generic texlive-luatex \
            latexmk poppler-utils

      - name: Build `MATHSYS` (latexmk)
        working-directory: ./math-systems
        run: |
          latexmk -pdf -interaction=nonstopmode -file-line-error "MATHSYS-Oefeningen-RubenRyckaert.tex"

      - name: Build `Warmte en stromingen` (latexmk)
        working-directory: "Warmte en stromingen"
        run: |
          latexmk -pdf -interaction=nonstopmode -file-line-error "Warmte en stromingen Samenvatting Ruben Ryckaert.tex"

      - name: Build `Productietechnologie` (latexmk)
        working-directory: ./Productietechnologie
        run: |
          latexmk -pdf -interaction=nonstopmode -file-line-error "ProductieTechnologie-Samenvatting-RubenRyckaert.tex"

      - name: Build `Ingenieur en economie oefeningen` (latexmk)
        working-directory: "Ingenieur en economie oefeningen"
        run: |
          latexmk -pdf -interaction=nonstopmode -file-line-error "Ingenieur&economie-oefeningen-RubenRyckaert.tex"

      - name: Build `Ingenieur en economie samenvatting` (latexmk)
        working-directory: "Ingenieur en economie oefeningen"
        run: |
          latexmk -pdf -interaction=nonstopmode -file-line-error "Ingenieur&economie-samenvatting-RubenRyckaert.tex"

      - name: Build `Examenoefening` (latexmk)
        working-directory: ./math-systems
        run: |
          latexmk -pdf -interaction=nonstopmode -file-line-error "Examenoefening.tex"

      - name: Build `template_examples` (latexmk)
        working-directory: ./latex_templates
        run: |
          latexmk -pdf -interaction=nonstopmode -file-line-error "template_examples.tex"

      - name: Upload built PDFs
        uses: actions/upload-artifact@v4
        with:
          name: built-pdfs
          retention-days: 90
          path: |
            math-systems/MATHSYS-Oefeningen-RubenRyckaert.pdf
            math-systems/Examenoefening.pdf
            Warmte en stromingen/Warmte en stromingen Samenvatting Ruben Ryckaert.pdf
            Productietechnologie/ProductieTechnologie-Samenvatting-RubenRyckaert.pdf
            Ingenieur en economie oefeningen/Ingenieur&economie-oefeningen-RubenRyckaert.pdf
            Ingenieur en economie oefeningen/Ingenieur&economie-samenvatting-RubenRyckaert.pdf
            latex_templates/template_examples.pdf
